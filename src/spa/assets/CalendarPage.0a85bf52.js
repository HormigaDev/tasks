import{_ as A,r as i,w as z,I as d,P as f,K as c,j as m,Q as L,aI as U,M as k,N as B,O as p,J as w,L as g,S as y,V as $,F as C,aK as S,aL as Y,D as J,U as b,aJ as E,d as O,q as P,H as Q}from"./index.b0e7c966.js";import{a as W,Q as V}from"./QList.d01e1cca.js";import{Q as K}from"./QPage.961fbc78.js";import{E as v,u as _}from"./EventBus.0832b019.js";import{T as H,N as R,f as G}from"./TaskComponent.778ee127.js";import{s as N}from"./virtualStorage.fcd16839.js";import{L as X}from"./utils.255e6c27.js";import{a as Z}from"./QSelect.de34ea6a.js";import{a as x,Q as I}from"./QItem.6a2a9afc.js";import"./QDate.0fd01da1.js";import"./date.9911f11f.js";import"./format.dc8d63aa.js";import"./QForm.c103ec47.js";import"./API.cd016945.js";import"./configs.0e8d95c2.js";function ee(e=new Date){return new Date(e.getFullYear(),e.getMonth()+1,0).getDate()}function F(e=new Date){let t=[["","","","","","",""],["","","","","","",""],["","","","","","",""],["","","","","","",""],["","","","","","",""],["","","","","","",""]];const n=ee(e),o=new Date(e.getFullYear(),e.getMonth(),1).getDay();let a=1;for(let s=0;s<6;s++)for(let h=0;h<7;h++)s===0&&h<o||a>n?t[s][h]="":(t[s][h]=a,a++);let l=[];for(let s=0;s<t.length;s++)for(let h=0;h<t[s].length;h++)l.push(t[s][h]);return l}const te={name:"CalendarTasks",props:{show:Boolean,taskList:Array,taskdate:String,_theme:String},emits:["update:show"],data(e){const t=i(e._theme),n=i(e.show),o=i(e.taskList),a=i(e.taskdate),l={urgent:{name:this.$t("pages.calendar.titles.priorities.urgent"),color:"negative"},high:{name:this.$t("pages.calendar.titles.priorities.high"),color:"warning"},normal:{name:this.$t("pages.calendar.titles.priorities.normal"),color:"primary"},low:{name:this.$t("pages.calendar.titles.priorities.low"),color:"grey-5"}};return z(()=>e.show,s=>{n.value=s}),z(()=>e._theme,s=>{t.value=s}),v.on("task-added",()=>{n.value=!1}),{theme:t,showTasks:n,tasks:o,priorities:l,colors:{primary:"white",negative:"red",green:"green"},date:a}},methods:{viewTask(e){this.$emit("update:showtask",e)},newTask(e){console.log(N.get("current_date")),this.$emit("update:newtask",e)}}},se={class:"text-h6"},ae={key:0,class:"absolute-top-left flex flex-center",style:{width:"100%",height:"60%",overflow:"hidden",top:"20%"}};function ne(e,t,n,o,a,l){return d(),f(Y,{persistent:"",modelValue:a.showTasks,"onUpdate:modelValue":t[2]||(t[2]=s=>a.showTasks=s),dark:a.theme==="dark"},{default:c(()=>[m(S,{dark:a.theme==="dark",style:{"min-width":"80%",position:"relative",height:"100%","max-height":"80vh"},class:"q-mt-xl"},{default:c(()=>[m(L,{flat:"",rounded:"",dense:"",icon:"close",class:"absolute-top-right q-mr-xs q-mt-xs",color:a.theme==="dark"?"white":"dark",onClick:t[0]||(t[0]=()=>{e.$emit("update:show",!1),a.showTasks=!1}),style:{"z-index":"99"}},null,8,["color"]),m(U,{class:"flex"},{default:c(()=>[k("div",se,[B(p(e.$t("pages.calendar.titles.tasks"))+" ",1),m(L,{class:"q-ml-md q-pl-xs q-pr-xs q-pt-none q-pb-none",size:"sm",color:"grey-8",icon:"add",onClick:t[1]||(t[1]=s=>l.newTask(a.date))})])]),_:1}),a.tasks.length===0?(d(),w("div",ae,[k("div",{class:g({"text-h4":!0,"text-grey-7":a.theme==="dark","text-grey-6":a.theme!=="dark"})},p(e.$t("pages.affairs.titles.nothing_to_show")),3)])):y("",!0),m(U,{style:{overflow:"auto","max-height":"60vh"}},{default:c(()=>[m(W,null,{default:c(()=>[(d(!0),w(C,null,$(a.tasks,(s,h)=>J((d(),f(x,{key:h,clickable:"",onClick:T=>l.viewTask(s)},{default:c(()=>[m(I,null,{default:c(()=>[m(Z,null,{default:c(()=>[B(p(s.title),1)]),_:2},1024)]),_:2},1024),m(I,{side:""},{default:c(()=>[s.status!=="ended"?(d(),f(V,{key:0,color:a.priorities[s.priority.name].color,label:a.priorities[s.priority.name].name},null,8,["color","label"])):(d(),f(b,{key:1,name:"check",style:{color:"green"}}))]),_:2},1024)]),_:2},1032,["onClick"])),[[E]])),128))]),_:1})]),_:1})]),_:1},8,["dark"])]),_:1},8,["modelValue","dark"])}var re=A(te,[["render",ne]]);const oe=O({components:{CalendarTasks:re,TaskComponent:H,NewTaskComponent:R},mounted(){_().loading.hide()},setup(){const e=i(N.get("theme")),t=i(F()),n=i(!0),o={0:"January",1:"February",2:"March",3:"April",4:"May",5:"June",6:"July",7:"August",8:"September",9:"October",10:"November",11:"December"},a=i(!1),l=["sun","mon","tues","wednes","thurs","fri","satur"],s=new Date,h=i(""),T=i([]),r=i({year:s.getFullYear(),month:s.getMonth(),day:s.getDate()}),D=i([]),u=()=>{G(r.value.month+1,r.value.year).then(({data:q,status:j})=>{j===200&&(D.value=q.tasks)}).catch(q=>{console.log(q)})},M=new X(()=>{e.value=N.get("theme"),u()});return M.start(),P(()=>{M.stop()}),v.on("deleted-task",()=>{u(),a.value=!1}),v.on("task-added",()=>{u(),a.value=!1}),v.on("finalized-task",()=>{u(),a.value=!1}),{theme:e,now:s,data:T,tasks:D,tasksDay:i([]),calendar:t,months:o,date:r,days:l,getCalendar:F,showTasks:a,showTask:i(!1),showNewTask:i(!1),task:i(null),newTaskDate:h,dateForTasks:i(""),canActualize:n,actualizeTasks:u}},methods:{selectMonth(e){if(this.canActualize=!1,this.tasksDay=[],e==="prev"){if(this.date.month-=1,this.date.month<0&&(this.date.month=11,this.date.year-=1,this.date.year<1900)){this.date.year=1900,this.date.month=0;return}}else this.date.month+=1,this.date.month>11&&(this.date.month=0,this.date.year+=1);let t=new Date(this.date.year,this.date.month);this.calendar=F(t),this.actualizeTasks(),setTimeout(()=>{this.canActualize=!0},100)},isWeekend(e){let t=new Date(this.date.year,this.date.month,e);return t.getDay()===0||t.getDay()===6},searchInDay(e){let t=this.tasks.filter(n=>{let[o,a,l]=n.runDate.split("-");return Number(l)===Number(e)&&n.status!=="archived"}).sort((n,o)=>{const a={ended:1,created:2,archived:0};return a[n.status]>a[o.status]?-1:a[n.status]<a[o.status]?1:0});return{tasks:t.slice(0,2),total:t.length}},showTasksData(e){const{year:t,month:n}=this.date;this.dateForTasks=`${t}-${("0"+(Number(n)+1)).slice(-2)}-${("0"+e).slice(-2)}`,N.set("current_date",this.dateForTasks),this.tasksDay=this.tasks.filter(o=>{let[a,l,s]=o.runDate.split("-");return Number(s)===Number(e)}).sort((o,a)=>{const l={ended:1,created:0,archived:0},s={urgent:4,high:3,normal:2,low:1};return l[o.status]!==l[a.status]?l[o.status]-l[a.status]:s[o.priority.name]>s[a.priority.name]?-1:s[o.priority.name]<s[a.priority.name]?1:0}).filter(o=>o.status!=="archived"),this.showTasks=!0},viewTask(e){this.task=e,this.showTask=!0},newTask(e){let[t,n,o]=e.split("-");e=`${t}-${("0"+n).slice(-2)}-${("0"+o).slice(-2)}`,this.showNewTask=!0,v.emit("calendar-new-task",e)},getColor(e,t){if(t==="ended")return"green-5";let n=new Date;return n=`${n.getFullYear()}-${("0"+(n.getMonth()+1)).slice(-2)}-${("0"+n.getDate()).slice(-2)}`,e=e.split(" ")[0].split("T")[0],e=e.split("-"),e=new Date(`${e[0]}-${e[1]}-${("0"+(Number(e[2])+1)).slice(-2)}`),e=`${e.getFullYear()}-${("0"+(e.getMonth()+1)).slice(-2)}-${("0"+e.getDate()).slice(-2)}`,console.log("DATE",e),console.log("NOW",n),e<n?"red-5":e>n?"blue-5":"orange-5"},editTask(){this.showTask=!1,this.showNewTask=!0}}}),le={class:"q-mt-sm flex row justify-center",style:{height:"32px"}},ie={class:"text-h6 text-center",style:{"min-width":"320px"}},de={class:"calendar-row q-mt-sm"},he={class:"calendar-row",style:{overflow:"auto"}},ue=["onClick"],me={class:"calendar-tasks flex column justify-end q-pl-sm q-pr-sm",style:{height:"100%"}},ce={key:0,class:"calendar-task-more full-width flex row justify-end"};function ke(e,t,n,o,a,l){const s=Q("CalendarTasks"),h=Q("TaskComponent"),T=Q("NewTaskComponent");return d(),f(K,{class:"flex column"},{default:c(()=>[e.showTasks?(d(),f(s,{key:0,taskList:e.tasksDay,show:e.showTasks,taskdate:e.dateForTasks,"onUpdate:show":t[0]||(t[0]=r=>e.showTasks=r),"onUpdate:showtask":e.viewTask,"onUpdate:newtask":e.newTask,_theme:e.theme},null,8,["taskList","show","taskdate","onUpdate:showtask","onUpdate:newtask","_theme"])):y("",!0),m(h,{task:e.task,show:e.showTask,"onUpdate:show":t[1]||(t[1]=r=>e.showTask=r),"onUpdate:edittask":e.editTask,_theme:e.theme},null,8,["task","show","onUpdate:edittask","_theme"]),m(T,{show:e.showNewTask,taskdate:e.newTaskDate,"onUpdate:show":t[2]||(t[2]=r=>e.showNewTask=r),_theme:e.theme},null,8,["show","taskdate","_theme"]),k("div",le,[m(b,{name:"chevron_left",class:g({"cursor-pointer":!0,"calendar-chevron":!0,"text-dark":e.theme!=="dark"}),onClick:t[3]||(t[3]=r=>e.selectMonth("prev"))},null,8,["class"]),k("div",ie,p(e.$t(`pages.calendar.titles.months.${("0"+(e.date.month+1)).slice(-2)}`))+" "+p(e.$t("pages.calendar.words.of"))+" "+p(e.date.year),1),m(b,{name:"chevron_right",class:g({"cursor-pointer":!0,"calendar-chevron":!0,"text-dark":e.theme!=="dark"}),onClick:t[4]||(t[4]=r=>e.selectMonth("next"))},null,8,["class"])]),k("div",null,[k("div",de,[(d(!0),w(C,null,$(e.days,r=>(d(),w("div",{key:r},p(e.$t(`pages.calendar.titles.weekdays.${r}`)),1))),128))]),k("div",he,[(d(!0),w(C,null,$(e.calendar,(r,D)=>(d(),w("div",{key:D,class:g({"calendar-day":!0,"calendar-day-empty":r==="","calendar-day-now":("0"+r).slice(-2)===("0"+e.date.day).slice(-2)&&e.now.getMonth()===e.date.month&&e.now.getFullYear()===e.date.year,"t-light":e.theme!=="dark"}),onClick:u=>r!==""?e.showTasksData(r):null},[k("small",{class:g({"calendar-id":!0,"calendar-weekend":e.isWeekend(r),"t-light":e.theme!=="dark","t-bold":e.theme!=="dark"})},p(r),3),k("div",me,[(d(!0),w(C,null,$(e.searchInDay(r).tasks,u=>(d(),w("div",{key:u.id+e.date.month,class:"calendar-task row full-width flex justify-between flex-center"},[e.canActualize?(d(),f(V,{key:0,label:u.title.substring(0,20)+"...",class:g("full-width q-mt-xs q-mb-xs bg-"+e.getColor(u.runDate,u.status)),style:{overflow:"hidden","max-width":"85%"}},null,8,["label","class"])):y("",!0),e.canActualize?(d(),f(b,{key:1,size:"xs",name:u.status==="ended"?"check":u.categories[0].icon,color:u.status==="ended"?"green-5":e.theme==="dark"?"white":"grey-8"},null,8,["name","color"])):y("",!0)]))),128)),e.searchInDay(r).total>2?(d(),w("div",ce,[k("small",null,"+"+p(e.searchInDay(r).total-2)+" tasks",1)])):y("",!0)])],10,ue))),128))])])]),_:1})}var Me=A(oe,[["render",ke]]);export{Me as default};
