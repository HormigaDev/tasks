import{Q as y}from"./QImg.00c70949.js";import{k as w,_ as Q,d as V,r as t,q,bq as S,H as v,I as u,P as p,K as n,L as h,M as i,j as s,O as d,U,N as g,S as C,aF as f,Q as k}from"./index.e4e1665e.js";import{Q as I}from"./QBanner.f0274d7c.js";import{Q as L}from"./QForm.ec3ed980.js";import{Q as B}from"./QSelect.7eeb172c.js";import{Q as P}from"./QPage.0b5360e2.js";import{A as N}from"./API.3709199d.js";import{a as c}from"./configs.2921b602.js";import{l as A}from"./bbel_full_logo.7dac59d7.js";import{L as E}from"./utils.a8996564.js";import{s as b}from"./virtualStorage.e693ceb7.js";import"./QItem.bda02f41.js";import"./format.16e7e6eb.js";async function O(e,o){const{data:l,status:a}=await N.post("/login",{email_username:e,password:o});return l.token?(w.set("token",l.token,{expires:365,secure:!0,sameSite:"strict"}),delete l.token,console.log(l==null?void 0:l.message),{status:a,res:!0}):(console.log(l.message),{status:a,res:!1})}const F=V({name:"AuthLoginPage",data(){var a,m;const e=t(b.get("theme")==="dark"),o=new E(()=>{e.value=b.get("theme")==="dark"});o.start(),q(()=>{o.stop()}),this.$i18n.locale=(a=localStorage.getItem("lang"))!=null?a:"en-US";const l=S();return w.get("token")&&l.push("/main/tasks"),{dark:e,email_username:t(""),password:t(""),loading:t(!1),error:t(""),locally:t(!1),lang:t((m=localStorage.getItem("lang"))!=null?m:"en-US"),langOptions:["en-US","es-ES","pt-BR"],logo:A}},methods:{login(){if(this.loading=!0,!this.email_username){this.error="Email or Username is required",this.loading=!1;return}if(!this.password){this.error="Password is required",this.loading=!1;return}O(this.email_username,this.password).then(({status:e,res:o})=>{if(e===404){this.error="User not found",this.loading=!1;return}if(!o){this.error="Invalid credentials",this.loading=!1;return}c("mainView").then(l=>{c("language").then(a=>{this.$i18n.locale=a!=null?a:"en-US",l?this.$router.push("/main/"+l):this.$router.push("/main/tasks")}).catch(a=>{console.log("Error getting locale",a),this.$router.push("/main/tasks")})}).catch(l=>{console.log("Error getting config",l),this.$router.push("/main/tasks")})}).catch(e=>{console.log("Login error",e),this.loading=!1,this.error=e.message})},changeLang(e){localStorage.setItem("lang",e),this.$i18n.locale=e}}}),R={class:"text-h5 q-mb-md flex flex-center"},j={class:"absolute-bottom-right"};function z(e,o,l,a,m,D){const $=v("router-link");return u(),p(P,{class:h({"t-login-bg flex flex-center q-pt-none":!0,"t-light":!e.dark})},{default:n(()=>[i("div",{class:h({"column flex-center flex":!0,"text-white":e.dark,"text-dark":!e.dark}),style:{"min-width":"300px"}},[i("div",null,[s(y,{src:e.logo,style:{width:"195px",height:"150px"},ratio:16/9},null,8,["src"])]),i("div",R,d(e.$t("pages.login.titles.login"))+" "+d(e.locally?`(${e.$t("pages.login.titles.locally")})`:""),1),s(L,{class:"t-login-form col-md-4"},{default:n(()=>[e.error?(u(),p(I,{key:0,rounded:"","inline-actions":"",class:"text-white bg-red q-mb-sm",dense:""},{avatar:n(()=>[s(U,{name:"error",color:"white"})]),default:n(()=>[g(" "+d(e.error),1)]),_:1})):C("",!0),s(f,{outlined:"",modelValue:e.email_username,"onUpdate:modelValue":o[0]||(o[0]=r=>e.email_username=r),label:e.$t("pages.login.inputs.labels.email_username"),type:"email",class:"full-width q-mb-md",dark:e.dark,color:e.dark?"white":"dark"},null,8,["modelValue","label","dark","color"]),s(f,{outlined:"",modelValue:e.password,"onUpdate:modelValue":o[1]||(o[1]=r=>e.password=r),label:e.$t("pages.login.inputs.labels.password"),type:"password",class:"full-width q-mb-md",dark:e.dark,color:e.dark?"white":"dark"},null,8,["modelValue","label","dark","color"]),i("small",null,[g(d(e.$t("pages.login.messages.dont_have_account"))+" ",1),s($,{to:"/auth/register"},{default:n(()=>[g(d(e.$t("pages.login.titles.register")),1)]),_:1})]),s(k,{style:{background:"#9c8449",color:"white"},label:e.$t("pages.login.buttons.login"),class:"full-width q-mb-md q-mt-sm",onClick:e.login,loading:e.loading,percentage:0,color:"accent"},null,8,["label","onClick","loading"]),s(k,{label:e.locally?e.$t("pages.login.buttons.login_online"):e.$t("pages.login.buttons.login_locally"),icon:"account_circle",class:"full-width",dark:e.dark,color:e.dark?"grey-8":"dark",onClick:o[2]||(o[2]=r=>e.locally=!e.locally)},null,8,["label","dark","color"])]),_:1})],2),i("div",j,[s(B,{label:e.$t("pages.login.inputs.labels.language"),outlined:"",dense:"",modelValue:e.lang,"onUpdate:modelValue":[o[3]||(o[3]=r=>e.lang=r),o[4]||(o[4]=r=>e.changeLang(r))],options:e.langOptions,color:e.dark?"white":"dark",dark:e.dark,class:"q-mb-sm q-mr-sm",style:{"min-width":"140px"}},null,8,["label","modelValue","options","color","dark"])])]),_:1},8,["class"])}var oe=Q(F,[["render",z]]);export{oe as default};
