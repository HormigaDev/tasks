import{_ as S,r as i,w as U,I as d,P as f,K as k,j as m,Q as F,aI as I,M as c,N as M,O as p,J as w,L as g,S as y,V as C,F as $,aK as j,aL as J,D as O,U as b,aJ as Y,d as E,q as P,H as Q}from"./index.1526ceda.js";import{a as K,Q as A}from"./QList.050e965c.js";import{Q as W}from"./QPage.49364285.js";import{E as v,u as _}from"./EventBus.cd526070.js";import{T as H,N as R,f as G}from"./TaskComponent.47c0e5f9.js";import{s as N,L as X}from"./utils.1e00f14b.js";import{a as Z}from"./QSelect.bc0c6282.js";import{c as x,a as B}from"./format.e5b37dc8.js";import"./date.38a4309f.js";import"./QForm.e88a91f9.js";import"./configs.3bfa595d.js";function ee(e=new Date){return new Date(e.getFullYear(),e.getMonth()+1,0).getDate()}function z(e=new Date){let t=[["","","","","","",""],["","","","","","",""],["","","","","","",""],["","","","","","",""],["","","","","","",""],["","","","","","",""]];const r=ee(e),o=new Date(e.getFullYear(),e.getMonth(),1).getDay();let a=1;for(let s=0;s<6;s++)for(let h=0;h<7;h++)s===0&&h<o||a>r?t[s][h]="":(t[s][h]=a,a++);let l=[];for(let s=0;s<t.length;s++)for(let h=0;h<t[s].length;h++)l.push(t[s][h]);return l}const te={name:"CalendarTasks",props:{show:Boolean,taskList:Array,taskdate:String,_theme:String},emits:["update:show"],data(e){const t=i(e._theme),r=i(e.show),o=i(e.taskList),a=i(e.taskdate),l={urgent:{name:this.$t("pages.calendar.titles.priorities.urgent"),color:"negative"},high:{name:this.$t("pages.calendar.titles.priorities.high"),color:"warning"},normal:{name:this.$t("pages.calendar.titles.priorities.normal"),color:"primary"},low:{name:this.$t("pages.calendar.titles.priorities.low"),color:"grey-5"}};return U(()=>e.show,s=>{r.value=s}),U(()=>e._theme,s=>{t.value=s}),v.on("task-added",()=>{r.value=!1}),{theme:t,showTasks:r,tasks:o,priorities:l,colors:{primary:"white",negative:"red",green:"green"},date:a}},methods:{viewTask(e){this.$emit("update:showtask",e)},newTask(e){console.log(N.get("current_date")),this.$emit("update:newtask",e)}}},se={class:"text-h6"},ae={key:0,class:"absolute-top-left flex flex-center",style:{width:"100%",height:"60%",overflow:"hidden",top:"20%"}};function ne(e,t,r,o,a,l){return d(),f(J,{persistent:"",modelValue:a.showTasks,"onUpdate:modelValue":t[2]||(t[2]=s=>a.showTasks=s),dark:a.theme==="dark"},{default:k(()=>[m(j,{dark:a.theme==="dark",style:{"min-width":"80%",position:"relative",height:"100%","max-height":"80vh"},class:"q-mt-xl"},{default:k(()=>[m(F,{flat:"",rounded:"",dense:"",icon:"close",class:"absolute-top-right q-mr-xs q-mt-xs",color:a.theme==="dark"?"white":"dark",onClick:t[0]||(t[0]=()=>{e.$emit("update:show",!1),a.showTasks=!1}),style:{"z-index":"99"}},null,8,["color"]),m(I,{class:"flex"},{default:k(()=>[c("div",se,[M(p(e.$t("pages.calendar.titles.tasks"))+" ",1),m(F,{class:"q-ml-md q-pl-xs q-pr-xs q-pt-none q-pb-none",size:"sm",color:"grey-8",icon:"add",onClick:t[1]||(t[1]=s=>l.newTask(a.date))})])]),_:1}),a.tasks.length===0?(d(),w("div",ae,[c("div",{class:g({"text-h4":!0,"text-grey-7":a.theme==="dark","text-grey-6":a.theme!=="dark"})},p(e.$t("pages.affairs.titles.nothing_to_show")),3)])):y("",!0),m(I,{style:{overflow:"auto","max-height":"60vh"}},{default:k(()=>[m(K,null,{default:k(()=>[(d(!0),w($,null,C(a.tasks,(s,h)=>O((d(),f(x,{key:h,clickable:"",onClick:T=>l.viewTask(s)},{default:k(()=>[m(B,null,{default:k(()=>[m(Z,null,{default:k(()=>[M(p(s.title),1)]),_:2},1024)]),_:2},1024),m(B,{side:""},{default:k(()=>[s.status!=="ended"?(d(),f(A,{key:0,color:a.priorities[s.priority.name].color,label:a.priorities[s.priority.name].name},null,8,["color","label"])):(d(),f(b,{key:1,name:"check",style:{color:"green"}}))]),_:2},1024)]),_:2},1032,["onClick"])),[[Y]])),128))]),_:1})]),_:1})]),_:1},8,["dark"])]),_:1},8,["modelValue","dark"])}var re=S(te,[["render",ne]]);const oe=E({components:{CalendarTasks:re,TaskComponent:H,NewTaskComponent:R},mounted(){_().loading.hide()},setup(){const e=i(N.get("theme")),t=i(z()),r=i(!0),o={0:"January",1:"February",2:"March",3:"April",4:"May",5:"June",6:"July",7:"August",8:"September",9:"October",10:"November",11:"December"},a=i(!1),l=["sun","mon","tues","wednes","thurs","fri","satur"],s=new Date,h=i(""),T=i([]),n=i({year:s.getFullYear(),month:s.getMonth(),day:s.getDate()}),D=i([]),u=()=>{G(n.value.month+1,n.value.year).then(({data:q,status:V})=>{V===200&&(D.value=q.tasks)}).catch(q=>{console.log(q)})},L=new X(()=>{e.value=N.get("theme"),u()});return L.start(),P(()=>{L.stop()}),v.on("deleted-task",()=>{u(),a.value=!1}),v.on("task-added",()=>{u(),a.value=!1}),v.on("finalized-task",()=>{u(),a.value=!1}),{theme:e,now:s,data:T,tasks:D,tasksDay:i([]),calendar:t,months:o,date:n,days:l,getCalendar:z,showTasks:a,showTask:i(!1),showNewTask:i(!1),task:i(null),newTaskDate:h,dateForTasks:i(""),canActualize:r,actualizeTasks:u}},methods:{selectMonth(e){if(this.canActualize=!1,this.tasksDay=[],e==="prev"){if(this.date.month-=1,this.date.month<0&&(this.date.month=11,this.date.year-=1,this.date.year<1900)){this.date.year=1900,this.date.month=0;return}}else this.date.month+=1,this.date.month>11&&(this.date.month=0,this.date.year+=1);let t=new Date(this.date.year,this.date.month);this.calendar=z(t),this.actualizeTasks(),setTimeout(()=>{this.canActualize=!0},100)},isWeekend(e){let t=new Date(this.date.year,this.date.month,e);return t.getDay()===0||t.getDay()===6},searchInDay(e){let t=this.tasks.filter(r=>{let[o,a,l]=r.runDate.split("-");return Number(l)===Number(e)&&r.status!=="archived"}).sort((r,o)=>{const a={ended:1,created:2,archived:0};return a[r.status]>a[o.status]?-1:a[r.status]<a[o.status]?1:0});return{tasks:t.slice(0,2),total:t.length}},showTasksData(e){const{year:t,month:r}=this.date;this.dateForTasks=`${t}-${("0"+(Number(r)+1)).slice(-2)}-${("0"+e).slice(-2)}`,N.set("current_date",this.dateForTasks),this.tasksDay=this.tasks.filter(o=>{let[a,l,s]=o.runDate.split("-");return Number(s)===Number(e)}).sort((o,a)=>{const l={ended:1,created:0,archived:0},s={urgent:4,high:3,normal:2,low:1};return l[o.status]!==l[a.status]?l[o.status]-l[a.status]:s[o.priority.name]>s[a.priority.name]?-1:s[o.priority.name]<s[a.priority.name]?1:0}).filter(o=>o.status!=="archived"),this.showTasks=!0},viewTask(e){this.task=e,this.showTask=!0},newTask(e){let[t,r,o]=e.split("-");e=`${t}-${("0"+r).slice(-2)}-${("0"+o).slice(-2)}`,this.showNewTask=!0,v.emit("calendar-new-task",e)},getColor(e,t){if(t==="ended")return"green-5";let r=new Date().toISOString().split("T")[0];return e<r?"red-5":e>r?"blue-5":"orange-5"},editTask(){this.showTask=!1,this.showNewTask=!0}}}),le={class:"q-mt-sm flex row justify-center",style:{height:"32px"}},ie={class:"text-h6 text-center",style:{"min-width":"320px"}},de={class:"calendar-row q-mt-sm"},he={class:"calendar-row",style:{overflow:"auto"}},ue=["onClick"],me={class:"calendar-tasks flex column justify-end q-pl-sm q-pr-sm",style:{height:"100%"}},ke={key:0,class:"calendar-task-more full-width flex row justify-end"};function ce(e,t,r,o,a,l){const s=Q("CalendarTasks"),h=Q("TaskComponent"),T=Q("NewTaskComponent");return d(),f(W,{class:"flex column"},{default:k(()=>[e.showTasks?(d(),f(s,{key:0,taskList:e.tasksDay,show:e.showTasks,taskdate:e.dateForTasks,"onUpdate:show":t[0]||(t[0]=n=>e.showTasks=n),"onUpdate:showtask":e.viewTask,"onUpdate:newtask":e.newTask,_theme:e.theme},null,8,["taskList","show","taskdate","onUpdate:showtask","onUpdate:newtask","_theme"])):y("",!0),m(h,{task:e.task,show:e.showTask,"onUpdate:show":t[1]||(t[1]=n=>e.showTask=n),"onUpdate:edittask":e.editTask,_theme:e.theme},null,8,["task","show","onUpdate:edittask","_theme"]),m(T,{show:e.showNewTask,taskdate:e.newTaskDate,"onUpdate:show":t[2]||(t[2]=n=>e.showNewTask=n),_theme:e.theme},null,8,["show","taskdate","_theme"]),c("div",le,[m(b,{name:"chevron_left",class:g({"cursor-pointer":!0,"calendar-chevron":!0,"text-dark":e.theme!=="dark"}),onClick:t[3]||(t[3]=n=>e.selectMonth("prev"))},null,8,["class"]),c("div",ie,p(e.$t(`pages.calendar.titles.months.${("0"+(e.date.month+1)).slice(-2)}`))+" "+p(e.$t("pages.calendar.words.of"))+" "+p(e.date.year),1),m(b,{name:"chevron_right",class:g({"cursor-pointer":!0,"calendar-chevron":!0,"text-dark":e.theme!=="dark"}),onClick:t[4]||(t[4]=n=>e.selectMonth("next"))},null,8,["class"])]),c("div",null,[c("div",de,[(d(!0),w($,null,C(e.days,n=>(d(),w("div",{key:n},p(e.$t(`pages.calendar.titles.weekdays.${n}`)),1))),128))]),c("div",he,[(d(!0),w($,null,C(e.calendar,(n,D)=>(d(),w("div",{key:D,class:g({"calendar-day":!0,"calendar-day-empty":n==="","calendar-day-now":("0"+n).slice(-2)===("0"+e.date.day).slice(-2)&&e.now.getMonth()===e.date.month&&e.now.getFullYear()===e.date.year,"t-light":e.theme!=="dark"}),onClick:u=>n!==""?e.showTasksData(n):null},[c("small",{class:g({"calendar-id":!0,"calendar-weekend":e.isWeekend(n),"t-light":e.theme!=="dark","t-bold":e.theme!=="dark"})},p(n),3),c("div",me,[(d(!0),w($,null,C(e.searchInDay(n).tasks,u=>(d(),w("div",{key:u.id+e.date.month,class:"calendar-task row full-width flex justify-between flex-center"},[e.canActualize?(d(),f(A,{key:0,label:u.title.substring(0,20)+"...",class:g("full-width q-mt-xs q-mb-xs bg-"+e.getColor(u.runDate,u.status)),style:{overflow:"hidden","max-width":"85%"}},null,8,["label","class"])):y("",!0),e.canActualize?(d(),f(b,{key:1,size:"xs",name:u.status==="ended"?"check":u.categories[0].icon,color:u.status==="ended"?"green-5":e.theme==="dark"?"white":"grey-8"},null,8,["name","color"])):y("",!0)]))),128)),e.searchInDay(n).total>2?(d(),w("div",ke,[c("small",null,"+"+p(e.searchInDay(n).total-2)+" tasks",1)])):y("",!0)])],10,ue))),128))])])]),_:1})}var Ne=S(oe,[["render",ce]]);export{Ne as default};
